(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5814453d"],{"059f":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0.6)",title:t.title,visible:t.visible,width:"1000px"},on:{close:t.handleClose,open:t.handleOpen}},[a("el-form",{ref:"dataForm",staticClass:"dialog-form",attrs:{rules:t.rules,model:t.data,"label-position":"left","label-width":"150px",inline:!0}},[a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Khách Hàng",prop:"customer"}},[a("el-input",{staticClass:"dialog-form-field",attrs:{placeholder:"Tên khách hàng"},model:{value:t.data.customer,callback:function(e){t.$set(t.data,"customer",e)},expression:"data.customer"}})],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Loại Lead",prop:"lead"}},[a("el-select",{staticClass:"filter-item dialog-form-field",attrs:{placeholder:"Chọn loại Lead"},model:{value:t.data.lead,callback:function(e){t.$set(t.data,"lead",e)},expression:"data.lead"}},t._l(t.leadOptions,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Sản Phẩm",prop:"product"}},[a("el-select",{staticClass:"filter-item dialog-form-field",attrs:{placeholder:"Chọn sản phẩm"},model:{value:t.data.product,callback:function(e){t.$set(t.data,"product",e)},expression:"data.product"}},t._l(t.productOptions,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Nhu Cầu Cụ Thể",prop:"demand"}},[a("el-input",{staticClass:"dialog-form-field",model:{value:t.data.demand,callback:function(e){t.$set(t.data,"demand",e)},expression:"data.demand"}})],1),a("el-row",[a("el-form-item",{attrs:{label:"Tương Tác",prop:"connection"}},[a("el-input",{staticClass:"dialog-form-textarea",attrs:{autosize:{minRows:2,maxRows:3},type:"textarea",placeholder:"Nội dung tương tác"},model:{value:t.data.connection,callback:function(e){t.$set(t.data,"connection",e)},expression:"data.connection"}})],1)],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Email",prop:"email"}},[a("el-input",{staticClass:"dialog-form-field",model:{value:t.data.email,callback:function(e){t.$set(t.data,"email",e)},expression:"data.email"}})],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Điện Thoại",prop:"phone"}},[a("el-input",{staticClass:"dialog-form-field",model:{value:t.data.phone,callback:function(e){t.$set(t.data,"phone",e)},expression:"data.phone"}})],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Ngày Bắt Đầu",prop:"time"}},[a("el-date-picker",{staticClass:"dialog-form-field",attrs:{placeholder:"Chọn ngày"},model:{value:t.data.time,callback:function(e){t.$set(t.data,"time",e)},expression:"data.time"}})],1),a("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"Chốt Deal",prop:"status"}},[a("el-select",{staticClass:"filter-item dialog-form-field",attrs:{placeholder:"Tình trạng deal"},model:{value:t.data.status,callback:function(e){t.$set(t.data,"status",e)},expression:"data.status"}},t._l(t.statusOptions,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("Huỷ")]),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("Xác Nhận")])],1)],1)},i=[],o=(a("d3b7"),a("c540")),s=a("1242"),r=a("cadb"),c=a("83d6"),l={name:"CustomerForm",filters:{parseHCMDate:r["b"]},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},data:{type:Object,default:void 0},method:{type:String,default:""},title:{type:String,default:""},tempStatus:{type:String,default:""}},data:function(){return{leadOptions:c["salesLeadOptions"],productOptions:c["productOptions"],statusOptions:c["statusOptions"],rules:{lead:[{required:!0,message:"Vui lòng chọn loại Lead",trigger:"change"}],time:[{type:"date",required:!0,message:"Vui lòng chọn ngày",trigger:"change"}],connection:[{required:!0,message:"Vui lòng nhập tương tác",trigger:"change"}],customer:[{required:!0,message:"Vui lòng nhập tên khách hàng",trigger:"change"}],product:[{required:!0,message:"Vui lòng chọn loại sản phẩm",trigger:"change"}],status:[{required:!0,message:"Vui lòng chọn trạng thái khách hàng",trigger:"change"}]}}},created:function(){},methods:{handleClose:function(){this.$emit("closeForm")},handleOpen:function(){var t=this;this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},handleSubmit:function(){var t=this;"update"===this.method?this.updateData().then((function(e){t.$emit("submit",e)})).catch((function(t){})):"create"===this.method&&this.createData().then((function(e){t.$emit("submit",e)})).catch((function(t){}))},updateData:function(){var t=this;return this.data.time=new Date(this.data.time),new Promise((function(e,a){t.$refs["dataForm"].validate((function(n){if(n){t.$emit("beforeSubmit");var i=Object.assign({},t.data);Object(s["a"])(i);var r=t.data,c=r.id,l=r.status;if(t.data.status!==t.tempStatus){var d=(new Date).toISOString(),u={id:c,status:l,modified_time:d};i.modified_time=d,Object(o["d"])(i,c).then((function(){t.$notify({title:"Thành Công",message:"Chỉnh sửa thành công",type:"success",duration:2e3}),e({listName:l,newItem:u})})).catch((function(t){a()}))}else Object(o["d"])(i,c).then((function(){t.$notify({title:"Thành Công",message:"Chỉnh sửa thành công",type:"success",duration:2e3}),e()})).catch((function(t){a()}))}else a()}))}))},createData:function(){var t=this;return new Promise((function(e,a){t.$refs["dataForm"].validate((function(n){if(n){var i=Object.assign({},t.data);Object(s["a"])(i),i.modified_time=i.time,Object(o["a"])(i).then((function(a){t.$notify({title:"Thành Công",message:"Thêm thành công",type:"success",duration:2e3}),i.id=a.data.insertId,e(i)})).catch((function(t){console.log(t),a()}))}else a()}))}))}}},d=l,u=(a("712a"),a("2877")),m=Object(u["a"])(d,n,i,!1,null,null,null);e["a"]=m.exports},1242:function(t,e,a){"use strict";function n(t){for(var e in t)if(t.hasOwnProperty(e)){var a=t[e];void 0===a&&(t[e]="")}}a.d(e,"a",(function(){return n}))},1848:function(t,e,a){"use strict";a("ffa9")},"3d2c":function(t,e,a){},5610:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.listLoading?t._e():a("div",{staticClass:"components-container board"},[t._l(t.statusObjects,(function(e){return a("Kanban",{key:e.name+e.componentKey,staticClass:"kanban",attrs:{group:t.group,"header-text":e.name,list:t.getListBasedOnStatus(e.name)},on:{openForm:t.openForm,updateColumn:t.handleModifiedTimeUpdate}})})),a("CustomerForm",{attrs:{title:"Chỉnh Sửa Khách Hàng",visible:t.dialogFormVisible,loading:t.dialogFormLoading,data:t.temp,"temp-status":t.tempStatus,method:"update"},on:{closeForm:t.closeForm,submit:t.handleSubmit,beforeSubmit:t.handleBeforeSubmit}})],2)},i=[],o=(a("4de4"),a("4160"),a("d81d"),a("b0c0"),a("159b"),a("2909")),s=a("5530"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"board-column"},[a("div",{staticClass:"board-column-header"},[t._v(t._s(t.headerText))]),a("draggable",t._b({staticClass:"board-column-content",attrs:{list:t.list,"set-data":t.setData},on:{change:t.changeHandle}},"draggable",t.$attrs,!1),t._l(t.list,(function(e){return a("div",{key:e.id,staticClass:"board-item",attrs:{options:{handle:".drag-this"}}},[a("div",{staticClass:"board-item-customer"},[t._v(t._s(e.customer))]),a("div",{staticClass:"board-item-time"},[t._v(" Tương tác cuối: "+t._s(t._f("parseHCMDate")(e.modified_time))+" ")]),a("div",{staticClass:"board-item-footer"},[a("div",{staticClass:"action"},[a("el-button",{attrs:{type:"success",icon:"el-icon-edit",size:"small",circle:""},on:{click:function(a){return t.handleEdit(e.id)}}})],1),a("div",{staticClass:"staff-avatar"},[a("el-tooltip",{attrs:{effect:"dark",content:e.customer,placement:"bottom"}},[a("el-avatar",{attrs:{size:"medium"}},[t._v(t._s(e.customer))])],1)],1)])])})),0)],1)},c=[],l=a("310e"),d=a.n(l),u=a("f6b0"),m=a("cadb"),f={name:"DragKanbanDemo",components:{draggable:d.a},filters:{parseHCMDate:m["b"]},props:{headerText:{type:String,default:"Header"},options:{type:Object,default:function(){return{}}},list:{type:Array,default:function(){return[]}}},methods:{setData:function(t){t.setData("Text","")},changeHandle:function(t){var e=this,a=void 0!==t.added;if(a){var n=t.added.element.id,i=(new Date).toISOString(),o={id:n,status:this.headerText,modified_time:i};Object(u["c"])(o,n).then((function(){e.$emit("updateColumn",{listName:e.headerText,newItem:o})})).catch((function(t){console.log(t)}))}},handleEdit:function(t){this.$emit("openForm",t)}}},p=f,h=(a("73cb"),a("2877")),b=Object(h["a"])(p,r,c,!1,null,"65d4acc8",null),g=b.exports,v=a("059f"),O={name:"DragKanbanDemo",components:{Kanban:g,CustomerForm:v["a"]},data:function(){return{group:"mission",list:null,listLoading:!0,statusObjects:[{name:"Hello",componentKey:0},{name:"Consulting",componentKey:0},{name:"Design Pick-up",componentKey:0},{name:"Contract Sent",componentKey:0},{name:"1st Deposit",componentKey:0},{name:"Production",componentKey:0},{name:"Fully Payment",componentKey:0},{name:"Lost",componentKey:0}],listQuery:{source:void 0},dialogFormVisible:!1,dialogFormLoading:!1,temp:{id:void 0,customer:void 0,lead:void 0,demand:void 0,connection:void 0,status:void 0,email:void 0,phone:void 0,product:void 0,time:void 0,modified_time:void 0},tempStatus:void 0}},created:function(){this.getData()},methods:{getData:function(){var t=this;Object(u["a"])(this.listQuery).then((function(e){t.list=t.prepareDraggableList(e.data.items),t.listLoading=!1}))},getListBasedOnStatus:function(t){return this.list[t]},prepareDraggableList:function(t){var e={};return this.statusObjects.forEach((function(a){var n=t.filter((function(t){return t.status===a.name}));e[a.name]=n})),e},openForm:function(t){var e=this;this.resetTemp(),this.dialogFormVisible=!0,this.dialogFormLoading=!0,Object(u["b"])(t).then((function(t){e.temp=t.data.items[0],e.dialogFormLoading=!1,e.tempStatus=e.temp.status}))},closeForm:function(){this.dialogFormVisible=!1},resetTemp:function(){this.temp={id:void 0,customer:void 0,lead:void 0,demand:void 0,connection:void 0,status:void 0,email:void 0,phone:void 0,product:void 0,time:void 0,modified_time:void 0}},handleBeforeSubmit:function(){this.dialogFormLoading=!0},handleSubmit:function(t){var e=this,a=Object(s["a"])({},this.list);if(this.temp.status===this.tempStatus){var n=Object(o["a"])(this.list[this.temp.status]);n=n.map((function(t){return t.id===e.temp.id?e.temp:t})),a[this.tempStatus]=n}else{var i=Object(o["a"])(this.list[this.tempStatus]);i=i.filter((function(t){return t.id!==e.temp.id})),a[this.tempStatus]=i;var r=Object(o["a"])(this.list[this.temp.status]),c=t.newItem;this.temp.modified_time=c.modified_time,r.unshift(this.temp),a[this.temp.status]=r}this.list=Object(s["a"])({},a),this.reRenderStatuses([this.tempStatus,this.temp.status]),this.dialogFormVisible=!1,this.dialogFormLoading=!1},handleModifiedTimeUpdate:function(t){var e=t.listName,a=t.newItem,n=a.id,i=a.modified_time,o=this.list[e].map((function(t){if(t.id===n){var e=Object(s["a"])({},t);return e.modified_time=i,e}return t}));this.list[e]=o,this.reRenderStatus(e)},reRenderStatus:function(t){var e=this.statusObjects.map((function(e){return e.name===t?{name:e.name,componentKey:e.componentKey+1}:e}));this.statusObjects=Object(o["a"])(e)},reRenderStatuses:function(t){var e=this;t.forEach((function(t){e.reRenderStatus(t)}))}}},C=O,y=(a("1848"),Object(h["a"])(C,n,i,!1,null,null,null));e["default"]=y.exports},"712a":function(t,e,a){"use strict";a("3d2c")},"73cb":function(t,e,a){"use strict";a("883f")},"7c9b":function(t,e,a){"use strict";a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return r}));a("4160"),a("caad"),a("4fad"),a("b64b"),a("2532"),a("159b");var n=a("3835"),i=a("5530");function o(t,e){var a=Object(i["a"])({},e);return Object.keys(a).forEach((function(e){t.includes(e)&&delete a[e]})),a}function s(t,e){var a=Object(i["a"])({},e);return Object.keys(a).forEach((function(e){t.includes(e)||delete a[e]})),a}function r(t,e){for(var a=0,i=Object.entries(e);a<i.length;a++){var o=Object(n["a"])(i[a],2),s=o[0],r=o[1];t[r]=t[s],delete t[s]}return t}},"883f":function(t,e,a){},c540:function(t,e,a){"use strict";a.d(e,"c",(function(){return c})),a.d(e,"a",(function(){return l})),a.d(e,"d",(function(){return d})),a.d(e,"b",(function(){return u}));a("99af"),a("4160"),a("159b");var n=a("5b6b"),i=a("bc3a"),o=a.n(i),s=a("7c9b"),r="/api/sales";function c(t){return Object(n["a"])({url:r,method:"get",params:t,transformResponse:o.a.defaults.transformResponse.concat((function(t){return t.items.forEach((function(t){return Object(s["c"])(t,{status_name:"status",product_name:"product",sale_lead_name:"lead"})})),t}))})}function l(t){return Object(n["a"])({url:r,method:"post",data:t})}function d(t,e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"put",data:t})}function u(t){return Object(n["a"])({url:"".concat(r,"/").concat(t),method:"delete"})}},cadb:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return s}));var n=new Intl.DateTimeFormat("id-ID",{timeZone:"Asia/Ho_Chi_Minh"});function i(t){if(void 0!==t&&""!==t&&null!==t){var e=Date.parse(t),a=n.format(e);return a}return""}var o={month:30,week:7,day:1};function s(t,e){var a=new Date,n=new Date,i=t*o[e];return n.setDate(a.getDate()-i),n}},f6b0:function(t,e,a){"use strict";a.d(e,"a",(function(){return c})),a.d(e,"b",(function(){return l})),a.d(e,"c",(function(){return d}));a("99af"),a("4160"),a("159b");var n=a("5b6b"),i=a("bc3a"),o=a.n(i),s=a("7c9b"),r="/api/customer";function c(t){return Object(n["a"])({url:r,method:"get",params:t,transformResponse:o.a.defaults.transformResponse.concat((function(t){return t.items.forEach((function(t){return Object(s["c"])(t,{status_name:"status"})})),t}))})}function l(t){return Object(n["a"])({url:"".concat(r,"/").concat(t),method:"get",transformResponse:o.a.defaults.transformResponse.concat((function(t){return t.items.forEach((function(t){return Object(s["c"])(t,{status_name:"status",product_name:"product",sale_lead_name:"lead"})})),t}))})}function d(t,e){return Object(n["a"])({url:"".concat(r,"/").concat(e),method:"put",data:t})}},ffa9:function(t,e,a){}}]);